2022-04-25  NIIBE Yutaka  <gniibe@fsij.org>

	Remove RSA support.
	* src/Makefile (CSRC): Remove call-rsa.c, bignum.c and rsa.c.
	* src/crypt.mk (CRYPTSRC): Remove rsa.c, bugnum.c and call-rsa.c.
	* src/call-rsa.c: Remove.
	* src/flash.c [FLASH_UPGRADE_SUPPORT] (flash_terminate): Remove
	update key support.
	[FLASH_UPGRADE_SUPPORT] (flash_write_binary): Remove
	FILEID_UPDATE_KEY_* support.
	* src/gnuk-malloc.h: Remove.
	* src/gnuk.h: Remove FILEID_UPDATE_KEY_*.
	(rsa_sign, modulus_calc, rsa_decrypt, rsa_verify, rsa_genkey):
	Remove.
	* src/gnuk.ld.in (_updatekey_store): Remove.
	* src/main.c (main): Remove malloc initialization.
	(gnuk_malloc_init, gnuk_sbrk, remove_from_free_list)
	(gnuk_malloc, gnuk_free): Remove.
	* src/openpgp-do.c (OPENPGP_ALGO_RSA): Remove.
	(algorithm_attr_rsa2k, algorithm_attr_rsa4k): Remove.
	(gpg_get_algo_attr): Remove RSA support.
	(get_algo_attr_data_object, gpg_get_algo_attr_key_size): Likewise.
	(do_alg_info, rw_algorithm_attr, gpg_do_write_prvkey): Likewise.
	(proc_key_import, gpg_do_public_key, gpg_do_keygen): Likewise.
	* src/openpgp.c (challenge): Remove.
	(gpg_get_firmware_update_key): Remove.
	(cmd_read_binary, modify_binary): Remove FILEID_UPDATE_KEY_* support.
	(cmd_pso): Remove RSA support.
	(cmd_internal_authenticate): Remove RSA support.
	(cmd_external_authenticate): Remove RSA authentication.
	(cmd_get_challenge): Work independently not related to
	EXTERNAL_AUTHENTICATE.
	* tests/rsa-aut.key, tests/rsa-dec.key, tests/rsa-sig.key: Remove.
	* tool/gnuk_token.py (gnuk_token.cmd_external_authenticate): Now,
	it does no authentication with FILEID_UPDATE_KEY_*.
	* tool/gnuk_upgrade.py (gpg_sign): Remove.
	(main): Remove support of specifying FILEID_UPDATE_KEY_*.
	* tool/upgrade_by_passwd.py (main): Remove support of specifying
	FILEID_UPDATE_KEY_*.

2022-04-22  NIIBE Yutaka  <gniibe@fsij.org>

	* src/gnuk.h (_regnual_start): Fix type.
	* src/main.c (main): Fix address for _regnual_start.
	* src/usb_ctrl.c (mem_info, usb_setup): Follow the change.
	* src/flash.c (_keystore_pool, _data_pool): Fix type.
	(FLASH_ADDR_KEY_STORAGE_START, FLASH_ADDR_DATA_STORAGE_START):
	Follow the change.

2022-03-26  Bertrand Jacquin <bertrand@jacquin.bzh>

	* regnual/regnual.c (memset): Remove declaration.
	* regnual/types.h (NULL): Remove.
	(size_t): Remove.

2021-11-02  NIIBE Yutaka  <gniibe@shouwa2020.gniibe.org>

	* src/ecc-mont.c (ecdh_compute_public_25519): Fix alignment
	problem.

2021-11-02  NIIBE Yutaka  <gniibe@fsij.org>

	* tests/: Add tests for ECC curves.  Support Yubikey.

2021-10-12  NIIBE Yutaka  <gniibe@fsij.org>

	Add Ed448 and X448 support, removing NIST P-256 support.
	* src/gnuk.h (ALGO_X448, ALGO_ED448): New.
	(ecdsa_sign_p256r1, ecc_compute_public_p256r1): Remove.
	(ecc_check_secret_p256r1, ecdh_decrypt_p256r1): Remove.
	(ecdh_compute_public_x448, ecdh_decrypt_x448): New.
	(ed448_sign, ed448_compute_public): New.

	* src/openpgp-do.c (algorithm_attr_ed448): New.
	(algorithm_attr_x448): New.
	(algorithm_attr_p256r1): Remove.
	(get_algo_attr_data_object): Remove for ALGO_NISTP256R1.
	Add for ALGO_ED448 and ALGO_X448.
	(gpg_get_algo_attr_key_size): Likewise.
	(do_alg_info): Support Ed448 and X448 too.
	(rw_algorithm_attr): Support Ed448 and X448 too.
	Remove for NIST P-256.
	(gpg_do_write_prvkey): Remove for NIST P-256.
	Add for Ed448 and X448.
	(proc_key_import): Likewise.
	(gpg_do_public_key): Likewise.
	(gpg_do_keygen): Likewise.

	* src/openpgp.c (ED25519_SIGNATURE_LENGTH): Rename from
	EDDSA_SIGNATURE_LENGTH.
	(cmd_pso): Remove for ALGO_NISTP256R1.
	Add for ALGO_ED448 and ALGO_X448.
	(cmd_internal_authenticate): Likewise.

	* src/p448.c, ecc-x448.c, ecc-ed448.c, shake256.c: New.

	* src/ecc-ed25519.c: Move from ecc-edwards.c.
	* misc/t-ed25519.c: Move from t-edwards.c.

2021-10-12  NIIBE Yutaka  <gniibe@fsij.org>

	* chopstx: Update to 2.3.

2021-10-11  NIIBE Yutaka  <gniibe@fsij.org>

	* src/configure (kdf_do): It can be overridden, now.

2021-07-01  NIIBE Yutaka  <gniibe@fsij.org>

	* src/configure (CONFIG): Add KDF configuration.

2021-06-10  NIIBE Yutaka  <gniibe@fsij.org>

	* tool/stlinkv2.py: Switch to Python3.

	* tool/upgrade_by_passwd.py: Fix option handling.

2021-04-30  NIIBE Yutaka  <gniibe@fsij.org>

	* src/openpgp-do.c (rw_algorithm_attr): Fix writing algorithm
	attribute, which may cause GC.  Note that flash_enum_write needs
	to call flash_enum_clear beforehand.

2021-04-28  Bertrand Jacquin <bertrand@jacquin.bzh>

	* regnual/regnual.c: Include <string.h>.

2021-04-01  NIIBE Yutaka  <gniibe@fsij.org>

	* tool/upgrade_by_passwd.py: Check configure target and
	the config in the device are same target.

2021-03-19  NIIBE Yutaka  <gniibe@fsij.org>

	* tests/openpgp_card.py (is_emulated_gnuk): Add.
	* tests/skip_if_emulation.py: New.
	* tests/skip_if_gnuk.py: New.
	* tests/test_001_personalize_card.py: Skip if emulation.
	* tests/test_002_personalize_reset.py: Skip if emulation.
	* tests/test_003_remove_keys.py: Skip if emulation.
	* tests/test_004_reset_pw3.py: Skip if emulation.
	* tests/test_005_personalize_admin_less.py: Skip if emulation.
	* tests/test_006_pso.py: Skip if Gnuk.
	* tests/test_009_keygen.py: Skip if emulation.
	* tests/test_021_personalize_admin_less.py: Rewrite.

2021-03-12  NIIBE Yutaka  <gniibe@fsij.org>

	* src/openpgp.c (cmd_pgp_gakp): Fix patch mistake.

2021-03-01  Vincent Pelletier <plr.vincent@gmail.com>

	* tests/card_const.py: Add attributes for more algos.
	* tests/card_test_ansix9p256r1.py: New.
	* tests/card_test_ansix9p384r1.py: New.
	* tests/card_test_ansix9p512r1.py: New.
	* tests/card_test_brainpoolp256r1.py: New.
	* tests/card_test_brainpoolp384r1.py: New.
	* tests/card_test_brainpoolp512r1.py: New.
	* tests/card_test_ed25519.py: New.
	* tests/card_test_x25519.py: New.
	* tests/func_pso_auth.py: New.
	* tests/test_006_pso.py: New.

2021-02-26  NIIBE Yutaka  <gniibe@fsij.org>

	* src/configure (kdf_do_required): Fix typo.

	* chopstx: Update to 2.2.
